---
authors: [mikhail]
slug: annotations-grafana-api-20230401/
tags: [Grafana HTTP API Data Source, Annotations]
image: /img/blog/2023-04-01-annotations-grafana-api/banner.png
keywords: [Grafana, HTTP API, Data Source, Annotations]
draft: true
---

import Code from "@theme/Code";
import Image from "@theme/Image";
import Video from "@theme/Video";

# Annotations, Alerts and Annotation Queries in Grafana

Grafana's time series visualization is designed to display one-dimensional data arrays. In most cases that we have come across, a time series panel shows data points collected from a device.

Out of the box, Grafana allows adding native annotations and alert rules for your time series. 

## Native Annotations

Native annotation is a simple commentary on a data point. Users with at least Editor privileges can add a native annotation manually by clicking on the data point of interest, typing a description, and specifying tags. 
Alternatively, you can create HTTP API calls to automate the entry process. 

<Image
  title="Editors and Administrator can add native annotations."
  src="/img/blog/2023-04-01-annotations-grafana-api/native.png"
/>


## Alerts 

Alerts might seem like a different kind of animal, but under the hood alerts are very similar to native annotations.

Alerts are created by the Grafana alert manager according to the alert rules you put in place. 
Here is an example of an alert rule:

```html
Watch the Value column from the Metric table, PostgreSQL data source.
Evaluate every 10 seconds for 30 seconds for the condition greater than 100. 
```

The rule means to capture three values (30 seconds/10 seconds). If all three are above 100, then fire an alert. 
In addition to generating an annotation, fire (or create) an alert means to send a notification via the configured channels.
Your options are Email, Slack messenger, and OnCall.

## Alerts vs Native annotations 

Native annotations serve well for non-time-critical comments, while alerts work best for vigilant data monitoring. The alert manager creates alerts according to the rules you put in place. 
Alerts immediately signal if something is off (the value is outside of the expected range).

People tend to reference both alerts and native annotations simply as annotations. This, unfortunately, confuses things a little further. 

<Image
  title="Annotations, Alerts, and Annotation queries in Grafana."
  src="/img/plugins/grafana/annotations.png"
/>

## Grafana configuration database

Both alerts and native annotations are stored in the Grafana configuration database.
Please, refer to another blog post where Daria explains in detail what that is. In short, every Grafana needs a configuration database to capture its settings (including native annotations and alerts). If you do not configure otherwise, you will end up with sqlite3 as your configuration database. The other choices are PostgreSQL and MySQL. 

<Image
  title="Blog post about Grafana configuration data base"
  src="/img/blog/2023-04-01-annotations-grafana-api/config-database-post.png"
  lazy={false}
/>

## Menu 

To access the configuration menu for alerts and native annotation use the 'Annotations' section of the dashboard setting menu.

<Image
  title="Alerting rules are periodically evaluated and fire if threshold is not met."
  src="/img/blog/2023-04-01-annotations-grafana-api/annotation-menu.png"
/>


To work with alert rules, go under the Alerting menu. 

<Image
  title="Alerting rules are periodically evaluated and fire if threshold is not met."
  src="/img/blog/2023-04-01-annotations-grafana-api/alerting.png"
/>

## Annotations queries

Annotation queries are an advanced way to work with annotation records. You can store annotation records in any database of your choice. However, that freedom comes with the cost of not having built-in compatibility with Grafana's visualization mechanisms. 
In other words, features like filters and XXX will be out of reach. 

That leads us to the question. How to have all built-in functionality around annotations, while having the most freedom with annotation types and visualization on the Time Series? 
The answer is:

## Grafana HTTP API Data Source

Grafana HTTP API Data Source allows:
 - connect to the Grafana configuration database,
 - work with local and remote Grafana instances,
 - use API Keys or tokens to request information and visualize in panels or use in annotations,
 - work with user-defined annotation types,
 - work with dashboard variables and utilize them as panel filters,
 - avoid the broken heart emoji, which is usually shown if at least one alert rule has been triggered. 

<Image
  title="Grafana HTTP API Data Source works with configuration database while is compatible with all Grafana's visualization features "
  src="/img/blog/2023-04-01-annotations-grafana-api/schema-around-config.png"
  lazy={false}
/>

The configuration menu where you specify which annotations to display using Grafana HTTP API Data source looks like this. 

<Image
  title="Display annotation using Grafana HTTP API Data Source for the selected dashboard variable."
  src="/img/blog/2023-04-01-annotations-grafana-api/annotations.png"
/>

## We healed a broken heart

As you know, if an alerting rule has a Dashboard and Panel Ids set, the Time Series panel will display the broken heart emoji. It is expected behavior for particular graphs which do not depend on the Dashboard variables.

However, when you display data points coming from multiple devices with user-defined alerts/annotations, the single broken heart emoji might be a misleading overkill. 

The broken heart emoji will not be displayed if you use Grafana HTTP API Data Source and configure dashboard filters XXX

## Introductory video

This is an introductory video highlighting the differences and similarities between Grafana alerts, annotations and annotation queries.

<Video
  src="https://www.youtube.com/embed/4asWJ_Dhcmw"
  title="Annotations, Alerts, and Annotation queries in Grafana explained."
/>

## Summary

Visualizing Annotations, Alerts, Annotation Queries on a Time Series graph allows one to see the big picture and react to the changes quickly.
