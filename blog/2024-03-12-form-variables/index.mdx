---
authors: [alex]
slug: form-panel-use-variables-20240301/
tags: [Data Manipulation]
image: /img/blog/2024-03-12-form-variables/banner.png
keywords: [Data Manipulation, Form Panel, Data, Grafana, Variables]
---

import Image from "@theme/Image";

# Update dashboard variables in Data Manipulation

## At a glance

In the blog post will be shown how to configure Data Manipulation panel to use and update variables.

## Preparation

Configure needed variables which will be used later in Data Manipulation panel: facility, room and bench. [Static Data Source](/plugins/volkovlabs-static-datasource) is used in the example.

Variables JSON

```json
[
  {
    "current": {
      "selected": false,
      "text": "facility3",
      "value": "facility3"
    },
    "hide": 0,
    "includeAll": false,
    "multi": false,
    "name": "facility",
    "options": [
      {
        "selected": false,
        "text": "facility1",
        "value": "facility1"
      },
      {
        "selected": false,
        "text": "facility2",
        "value": "facility2"
      },
      {
        "selected": true,
        "text": "facility3",
        "value": "facility3"
      }
    ],
    "query": "facility1, facility2, facility3",
    "queryValue": "",
    "skipUrlSync": false,
    "type": "custom"
  },
  {
    "current": {
      "selected": false,
      "text": "facility3-room1",
      "value": "facility3-room1"
    },
    "datasource": {
      "type": "marcusolsson-static-datasource",
      "uid": "P1D2C73DC01F2359B"
    },
    "definition": "",
    "hide": 0,
    "includeAll": false,
    "multi": false,
    "name": "room",
    "options": [],
    "query": {
      "frame": {
        "fields": [
          {
            "config": {},
            "name": "value",
            "type": "string",
            "values": ["$facility-room1", "$facility-room2"]
          },
          {
            "config": {},
            "name": "label",
            "type": "string",
            "values": ["$facility-room1", "$facility-room2"]
          }
        ],
        "meta": {}
      }
    },
    "refresh": 1,
    "regex": "",
    "skipUrlSync": false,
    "sort": 0,
    "type": "query"
  },
  {
    "current": {
      "selected": false,
      "text": "facility3-room1-bench2",
      "value": "facility3-room1-bench2"
    },
    "datasource": {
      "type": "marcusolsson-static-datasource",
      "uid": "P1D2C73DC01F2359B"
    },
    "definition": "",
    "hide": 0,
    "includeAll": false,
    "multi": false,
    "name": "bench",
    "options": [],
    "query": {
      "frame": {
        "fields": [
          {
            "config": {},
            "name": "value",
            "type": "string",
            "values": ["$room-bench1", "$room-bench2"]
          },
          {
            "config": {},
            "name": "label",
            "type": "string",
            "values": ["$room-bench1", "$room-bench2"]
          }
        ],
        "meta": {}
      }
    },
    "refresh": 1,
    "regex": "",
    "skipUrlSync": false,
    "sort": 0,
    "type": "query"
  }
]
```

Variables should be shown on the dashboard.

<Image
  title="Configured variables on the dashboard."
  src="/img/blog/2024-03-12-form-variables/variables.png"
/>

## Setup form elements

Add 3 select with Custom Options form elements: facility, room and bench to the Data Manipulation panel.

<Image
  title="Configured elements in the Data Manipulation panel."
  src="/img/blog/2024-03-12-form-variables/form-elements.png"
/>

## Add dynamic options to elements

Currently, the elements don't have any options let's fix it and setup dynamic options from panel queries.

Create panel queries with Static Data Source for all dynamic options. Usually, it should be equal to the variable query.

<Image
  title="Facility options data."
  src="/img/blog/2024-03-12-form-variables/facility-options-query.png"
/>

Next, need to set appropriated fields to the form elements

<Image
  title="Use options from query."
  src="/img/blog/2024-03-12-form-variables/query-options-source.png"
/>

Since now, the form elements have options which is retrieved from panel data.

<Image
  title="Query data options."
  src="/img/blog/2024-03-12-form-variables/query-options-example.png"
/>

## Configure initial values

Currently, the initial form values are empty. Let's configure a query which returns variable values.

<Image
  title="Initial values query for the panel."
  src="/img/blog/2024-03-12-form-variables/initial-values.png"
/>

Next, need to update the panel options to enable query options for initial action.
Keep sure that sync option is also enabled.

<Image
  title="Enabled query initial action and sync."
  src="/img/blog/2024-03-12-form-variables/query-initial-action.png"
/>

After that, the elements have query field. Need to set appropriated field for each element.

<Image
  title="Configured query field for element."
  src="/img/blog/2024-03-12-form-variables/element-query-field.png"
/>

Since now, if variable is updated, the value will be pre-populated to the form.

<Image
  title="Initial values from variable values."
  src="/img/blog/2024-03-12-form-variables/initial-values-example.png"
/>

## Update variables from the panel

To update select options, the variable should be updated. There is needed to
configure the Element Value Changed code for updating variables if element changed.

```js
if (context.element.id === "facility") {
  context.grafana.locationService.partial({
    "var-facility": context.element.value,
  });
}

if (context.element.id === "room") {
  context.grafana.locationService.partial({
    "var-room": context.element.value,
  });
}

if (context.element.id === "bench") {
  context.grafana.locationService.partial({
    "var-bench": context.element.value,
  });
}
```

Since now, if element changed, the variable will be updated as well as select options.

## Enable submit button

Enablement of submit button depends on if current values are different from the initial.
In our case, they are equal. So the submit button is always disabled.

To enable it after user interaction we have to select Manual mode for the Enable Update option.

<Image
  title="Manual enabled mode for submit button."
  src="/img/blog/2024-03-12-form-variables/enable-update-manual.png"
/>

After that, we have to adjust the Element Value Changed code to enable submit button ourself.

Element Value Changed

```js
context.panel.enableSubmit();
```

Working dashboard example are available in the [GitHub repository](https://github.com/VolkovLabs/volkovlabs-form-panel/blob/main/provisioning/dashboards/variables.json).

If you have any questions about this article, please, do not hesitate to leave them in the comments section under the [YouTube videos](https://www.youtube.com/@volkovlabs).
