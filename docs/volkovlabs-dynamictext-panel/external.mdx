---
tags:
  - Business Text
  - Events
image: /img/plugins/volkovlabs-dynamictext-panel/external.png
---

import Code from "@theme/Code";
import Image from "@theme/Image";
import Video from "@theme/Video";

# External JavaScript and CSS

:::info Version

The Business Text Panel supports external resources starting from version 4.1.0.

:::

The Business Text Panel enables the loading of additional JavaScript and CSS resources using external URLs like CDN (Content Delivery Network).

Use that functionality to include additional visual elements and execute JavaScript functions in the [JavaScript Code](/plugins/volkovlabs-dynamictext-panel/code) editor.

To prevent the loading of third-party URLs, you can store CSS and JS files in the public folder on your Grafana instance.

<Image
  title="Loading Google Material CSS and JS files from an external resource."
  src="/img/plugins/volkovlabs-dynamictext-panel/external.png"
/>

## Manual scripts

In the event when a library can not be referenced as an external script, you always can reference and initiate it directly in the **JavaScript->After Content Ready**

<Image
  title="Alternative way to load an external llibrary."
  src="/img/plugins/volkovlabs-dynamictext-panel/alt.png"
/>

### Content

Into the **Content**:

```diagramm
<pre class="mermaid">
    graph LR
    A --- B
    B-->C[fa:fa-ban {{data.0.test}}]
    B-->D(fa:fa-spinner);
</pre>
```

### JavaScript

Into the **JavaScript->After Content Ready**:

```js
const script = document.createElement("script");

script.src = "https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js";

document.body.appendChild(script);

mermaid.initialize({ startOnLoad: true });

mermaid.run({
  querySelector: ".mermaid",
  suppressErrors: false,
});
```

## External JavaScript resources

Below you can find a collection of breathtaking use cases for the external JavaScript resources in the Business Text plugin.

### Plotly 3D Scatter

Thanks to our community member [Josiah Solomon](https://github.com/yosiasz) for the provided solution.

Use the following external Plotly's 3D Scatter chart library:

```md
https://esm.sh/plotly.js-dist-min
```

:::info

Grafana's edit mode might prevent displaying Plotly charts. Save and check the result on the dashboard.

:::

You can run this example in two ways:

- inserting the provided code from the below into the Default content
- inserting the provided code from the below into the Content

#### Use the Default Content

<Image
  title="Option 1. Use that option when the data source is set to return nothing."
  src="/img/plugins/volkovlabs-dynamictext-panel/plotly-1.png"
/>

#### Use the Content

<Image
  title="Option 2. Use that option when the data source is set to return something."
  src="/img/plugins/volkovlabs-dynamictext-panel/plotly-2.png"
/>

#### Code to copy

Into the **Content** or **Default Content**:

```html
<div id="plotly-chart" />
```

Into the **JavaScript->Before Content Rendering**:

<details>
  <summary>JavaScript code for Plotly example</summary>

```js
const unpack = (rows, key) => {
  return rows.map(function (row) {
    return row[key];
  });
};

const csvToJson = (data, delimiter = ",") => {
  const titles = data.slice(0, data.indexOf("\r\n")).split(delimiter);
  return data
    .slice(data.indexOf("\n") + 1)
    .split("\r\n")
    .map((v) => {
      const values = v.split(delimiter);
      return titles.reduce(
        (obj, title, index) => ((obj[title] = values[index]), obj),
        {}
      );
    });
};

/**
 * Load plotly
 */
import("https://esm.sh/plotly.js-dist-min").then(
  async ({ default: Plotly }) => {
    let url =
      "https://raw.githubusercontent.com/plotly/datasets/master/3d-scatter.csv";

    let fetchData = await fetch(url);
    let csvData = await fetchData.text();
    let rows = csvToJson(csvData);

    var trace1 = {
      x: unpack(rows, "x1"),
      y: unpack(rows, "y1"),
      z: unpack(rows, "z1"),
      mode: "markers",
      marker: {
        size: 12,
        line: {
          color: "rgba(217, 217, 217, 0.14)",
          width: 0.5,
        },
        opacity: 0.8,
      },
      type: "scatter3d",
    };

    var trace2 = {
      x: unpack(rows, "x2"),
      y: unpack(rows, "y2"),
      z: unpack(rows, "z2"),
      mode: "markers",
      marker: {
        color: "rgb(127, 127, 127)",
        size: 12,
        symbol: "circle",
        line: {
          color: "rgb(204, 204, 204)",
          width: 1,
        },
        opacity: 0.8,
      },
      type: "scatter3d",
    };

    var data = [trace1, trace2];

    var layout = {
      margin: {
        l: 0,
        r: 0,
        b: 0,
        t: 0,
      },
    };

    var config = { responsive: true };

    Plotly.newPlot("plotly-chart", data, layout, config);
  }
);
```

</details>

### Mermaid

Mermaid is a popular JavaScript-based diagramming and charting tool that dynamically creates and modifies diagrams using Markdown-defined text definitions.

:::info
Previously we maintained two Business text (old name Dynamic Text) plugin builds. One with embedded Mermaid Library and the other without.

The main reason being the Mermaid Library size. After we added the External Resources feature, the need to maintain two builds has vanished. Now, anyone who needs the Mermaid library can simply load it as an external resource.
:::

<Image
  title="Mermaid diagrams displayed using the Business Text Panel."
  src="/img/plugins/volkovlabs-dynamictext-panel/diagram.png"
/>

#### Example

<Image
  title="Mermaid diagrams example."
  src="/img/plugins/volkovlabs-dynamictext-panel/mer.png"
/>

Use the following external library

```md
https://esm.sh/mermaid
```

#### Code to copy

Use the following for the **Content** (when your data source is set to return something) or in the **Default Content** (when your data source returns nothing):

```diagram
<pre class="mermaid">
    graph LR
    A --- B
    B-->C[fa:fa-ban {{data.0.test}}]
    B-->D(fa:fa-spinner);
</pre>
```

Use the following for the **JavaScript->After Content Ready**:

```js
import("https://esm.sh/mermaid").then(({ default: mermaid }) => {
  mermaid.initialize({ startOnLoad: true });

  mermaid.run({
    querySelector: ".mermaid",
    suppressErrors: false,
  });
});
```

### Chart.js

Chart.js is one of the popular open source charting libraries. The Business Text plugin makes using chart.js in Grafana possible!

<Image
  title="Chart.js diagrams displayed using the Business Text Panel."
  src="/img/plugins/volkovlabs-dynamictext-panel/chartjs-examples.png"
/>

#### Example

<Image
  title="Chart.js diagram example."
  src="/img/plugins/volkovlabs-dynamictext-panel/chartjs.png"
/>

Use the following external library

```md
https://esm.sh/chart.js
```

#### Code to copy

Use the following for the **Content**:

```js
<canvas id="myChart" />
```

Use the following for the **JavaScript->After Content Ready**:

```js
import("https://esm.sh/chart.js").then(({ Chart, registerables }) => {
  Chart.register(...registerables);

  /**
   * Cleanup
   */
  if (this.chartInstance) {
    this.chartInstance.destroy();
  }

  const ctx = document.getElementById("myChart");

  this.chartInstance = new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
      datasets: [
        {
          label: "# of Votes",
          data: [12, 19, 3, 5, 2, 3],
          borderWidth: 1,
        },
      ],
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  });
});
```

### Flowchart

Thank you [Josiah Solomon](https://github.com/yosiasz) for exploring an epic Flowchart return to Grafana! We are happy to share your example with the world.

Below you can find how the beloved by many Flowchart libraries can be implemented using the Business Text plugin.

Simply, add two external libraries and then write your code addressing the Flowchart libraries directly.

#### Example

<Image
  title="Delivering Flowchart libraries to a Grafana dashboard using the Business Text plugin."
  src="/img/blog/2024-01-12-dynamictext-panel-4.3.0/flow.png"
/>

#### External Resources

```
https://esm.sh/flowchart.js
https://esm.sh/raphael
```

#### Content to copy

```html
<div id="flowchart" />
```

#### JavaScript code to copy

```
import('https://esm.sh/flowchart.js').then(async (flowchart) => {
  await import('https://esm.sh/raphael');

  const flow = `
st=>start: Start:>http://www.google.com[blank]
e=>end:>http://www.google.com
op1=>operation: My Operation
sub1=>subroutine: My Subroutine
cond=>condition: Yes
or No?:>http://www.google.com
io=>inputoutput: catch something...
para=>parallel: parallel tasks
in=>input: some in
out=>output: some out

st->op1->cond
cond(yes)->io->e
cond(no)->para
para(path1, bottom)->sub1(right)->op1
para(path2, top)->op1
para(path3, right)->in->out->e`

  const diagram = flowchart.parse(flow);
  diagram.drawSVG('flowchart');
})
```

:::info Render template parameter

Use **All rows** or **All data** template to execute template only once. With **Every row**, the **Content** will be applied to every row of retrieved data. Even though the data frames of the specified data source are not used, still the plugin runs the code as many times as the number of rows is retrieved.

:::

### Youtube video

This idea comes from the [GitHub issue](https://github.com/VolkovLabs/volkovlabs-dynamictext-panel/issues/261) opened by [Raphealtony](https://github.com/Raphealtony). The Business Text plugin can be used to display YouTube videos on your Grafana dashboard.

<Image
  title="How to configure the Business Text plugin to display a YouTube video."
  src="/img/plugins/volkovlabs-dynamictext-panel/yt-edit.png"
/>

#### External Resources

```
https://www.youtube.com/iframe_api
```

#### Content to copy

```html
<h1>Volkov Labs Latest videos</h1>
<div id="player"></div>
```

#### JavaScript code to copy

```js
import("https://esm.sh/youtube-player").then(({ default: YouTubePlayer }) => {
  const player = YouTubePlayer("player");

  const videoList = ["AcQi-6GCrNU", "1ogv2jstrlI", "vky-7-DfvXE"];

  const randomVideoId = videoList[Math.floor(Math.random() * videoList.length)];

  player.loadVideoById(randomVideoId);
});
```

Below is an example of a dashboard displaying a YouTube video.

<Image
  title="Use the Business Text plugin to display YouTube videos on your Grafana dashboard."
  src="/img/plugins/volkovlabs-dynamictext-panel/yt.png"
/>

### Leaflet.js interactive maps

This is another great example of external resource usage in the Business Text Plugin. The idea comes from [BlinderMiri](https://github.com/BlinderMiri) and [Josiah Solomon](https://github.com/yosiasz). Follow the below outlined steps to display Leaflet.js maps on your Grafana dashboard.

<Image
  title="How to configure the Business Text plugin to display Leaflet.js maps."
  src="/img/plugins/volkovlabs-dynamictext-panel/leaflet-edit.png"
/>

The map on the dashboard from this example looks like in the illustration below.

<Image
  title="The Leaflet.js map on the dashboard."
  src="/img/plugins/volkovlabs-dynamictext-panel/leaflet-display.png"
/>

#### Data can be set using Static Data Source

```js
{   "type": "Feature",   "geometry": {     "type": "Point",     "coordinates": [125.6, 10.1]   },   "properties": {     "name": "Dinagat Islands"   } }
```

#### External Resources

```
https://unpkg.com/leaflet@1.9.4/dist/leaflet.css
https://esm.sh/leaflet
```

#### Content

```html
<div id="leaflet" />
```

#### JavaScript code

```js
// This data is coming from the data source.
// const geojson = JSON.parse(context.data[0][0].data);

import("https://esm.sh/leaflet").then(({ default: L }) => {
  /**
   * Cleanup
   */
  if (this.map) {
    this.map.remove();
  }

  const map = L.map("leaflet").setView([9.024857, 38.737607], 13);
  this.map = map;

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution:
      'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
    maxZoom: 18,
  }).addTo(map);

  //if you want to use inline data
  const geojson = {
    type: "FeatureCollection",
    crs: {
      type: "name",
      properties: { name: "urn:ogc:def:crs:OGC:1.3:CRS84" },
    },
    features: [
      {
        type: "Feature",
        properties: { AOIs: "bbb", daily: "33" },
        geometry: {
          type: "Polygon",
          coordinates: [
            [
              [33.5, 32.0],
              [33.5, 29.0],
              [36.0, 29.0],
              [36.0, 27.5],
              [33.5, 27.5],
              [32.5, 27.5],
              [29.0, 27.5],
              [29.0, 32.0],
              [33.5, 32.0],
            ],
          ],
        },
      },
      {
        type: "Feature",
        properties: { AOIs: "aaa", daily: "23" },
        geometry: {
          type: "Polygon",
          coordinates: [
            [
              [34.5, 32.5],
              [36.0, 32.5],
              [36.0, 29.0],
              [33.5, 29.0],
              [33.5, 32.0],
              [33.5, 32.5],
              [34.5, 32.5],
            ],
          ],
        },
      },
    ],
  };

  var myStyle = {
    color: "black",
    weight: 10,
  };

  var geojsonLayer = L.geoJSON(geojson).addTo(map);
});
```

#### CSS styles

```css
#leaflet {
  height: 480px;
  display: flex;
  flex-direction: row;
}
```

### Advanced using Leaflet.js interactive maps

This is example based on example above and extend it with using dashboard variables and another approach to using `Leaflet.js` in the Business Text Plugin.
Follow the below outlined steps to display Leaflet.js maps on your Grafana dashboard.

Dashboard variables

```SQL
select 'China' as __text, '104.1954,35.8617' as __value union
select 'Ethiopia', '40.4897,9.1450' union
select 'Sardina', '9.283447, 40.078072'
```

#### External Resources

```
https://unpkg.com/leaflet@1.9.4/dist/leaflet.css
https://esm.sh/leaflet
```

#### Content

```html
<div id="leaflet"></div>
```

#### Code After Content section

```js
// This data is coming from the data source.

import('https://esm.sh/leaflet').then(({ default: L }) => {
  /**
   * Cleanup
   */
  if (this.map) {
    this.map.remove();
  }

  var countries = context.grafana.replaceVariables("${countries:value}")
  var lon = Number(countries.split(",")[0])
  var lat = Number(countries.split(",")[1])

  var map = new L.Map('leaflet');
  map.setView(new L.LatLng(lat, lon), 4);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution:
      'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
    maxZoom: 10,
  }).addTo(map);
}):
```

#### CSS styles

```css
#leaflet {
  height: 480px;
  display: flex;
  flex-direction: row;
}
```

### Tailwind CSS

Thank you [Raghavendra Samant](https://github.com/samant-rags) for exploring a utility-first CSS framework Tailwind CSS. Tailwind adds style and beauty to your panels. Applying Tailwind to Business Text is a little different from the previous examples.

<Image
  title="Panel with Tailwind styles on the dashboard."
  src="/img/plugins/volkovlabs-dynamictext-panel/tailwind-panel.png"
/>

To prevent CORS issue we recommend to add Tailwind script to the Grafana's public folder `/usr/share/grafana/public/yourFileName.js`.

File can contain the import function and use Ttailwind, or it can load code from `cdn.tailwindcss.com`.

#### CDN based code

Create a `tailwind.js` file with the code from `cdn.tailwindcss.com` and upload to `/usr/share/grafana/public/` in Docker container. We used latest version `https://cdn.tailwindcss.com/3.4.4`.

<Image
  title="Tailwind script uploaded to the Docker container."
  src="/img/plugins/volkovlabs-dynamictext-panel/tailwind-file-example.png"
/>

#### Content

```html
<div class="bg-gray-100 min-h-64 flex items-center justify-center">
  <div class="bg-white shadow-md rounded-lg p-8 max-w-md w-full">
    <h1 class="text-2xl font-bold mb-4">Welcome to Business Text</h1>
    <p class="text-gray-600 mb-6">
      This is a simple HTML element using the Tailwind CSS library.
    </p>
    <a
      href="#"
      class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md"
      >Learn More</a
    >
  </div>
</div>
```

#### JavaScript code (After Content Ready)

```js
import("/public/tailwind.js");
```

<Image
  title="Business Text panel with imported Tailwind CSS."
  src="/img/plugins/volkovlabs-dynamictext-panel/tailwind-panel-edit-mode.png"
/>

#### Load Tailwind from CDN

Create a `loadTailwindFromCDN.js` file with the following code and upload to the same location in Docker container.

```js
function loadTailwindFromCDN() {
  var responseData = "";

  const script = document.createElement("script");

  script.src = "https://cdn.tailwindcss.com";
  document.body.appendChild(script);

  console.log("script" + script);
}

export default loadTailwindFromCDN;
```

#### Content

```html
<div class="bg-gray-100 min-h-64 flex items-center justify-center">
  <div class="bg-white shadow-md rounded-lg p-8 max-w-md w-full">
    <h1 class="text-2xl font-bold mb-4">Welcome to Business Text</h1>
    <p class="text-gray-600 mb-6">
      This is a simple HTML element using the Tailwind CSS library.
    </p>
    <a
      href="#"
      class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md"
      >Learn More</a
    >
  </div>
</div>
```

#### JavaScript code (After Content Ready)

```js
import("/public/loadTailwindFromCDN.js").then(
  ({ default: loadTailwindFromCDN }) => {
    loadTailwindFromCDN();
  }
);
```
